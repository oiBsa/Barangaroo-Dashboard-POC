{% load static %}
<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Boxicons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <!-- My CSS -->
    <link rel="stylesheet" href="{% static 'admin/css/tree.css'%}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-latest.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"
        integrity="sha512-SGWgwwRA8xZgEoKiex3UubkSkV1zSE1BS6O4pXcaxcNtUlQsOmOmhVnDwIvqGRfEmuz83tIGL13cXMZn6upPyg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://code.jscharting.com/latest/jscharting.js"></script>
    <script type="text/javascript" src="https://code.jscharting.com/latest/modules/toolbar.js"></script>
    <script type="text/javascript" src="https://code.jscharting.com/latest/modules/types.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <title>Dashboard</title>
</head>

<body>


    <!-- SIDEBAR -->
    <section id="sidebar" class="hide hidden">
        <a href="{% url 'home' %}" class="brand">
            <img class="oi-icon"
                src="https://media-exp1.licdn.com/dms/image/C560BAQEAPjKix24H5A/company-logo_200_200/0/1574388135440?e=1672272000&v=beta&t=SBjMJWO6LihSvjdzM88Lvk15riwX8TkLhz_SNQhDWDw"
                alt="Operational Interlligence">
            <span class="text">Operational Intelligence</span>
        </a>
        <ul
            style="display: flex; flex-direction: column; align-content: flex-end; flex-wrap: nowrap; justify-content: center; align-items: center;">
            <li
                style="align-content:center;margin-top: 0.5rem;margin-bottom: 0.5rem;text-align: center;text-decoration: none; --selectionColor: #FF7F7F; --selectionColorBG: #ff7f7f83;">
                <a href="{% url 'ems'%}" class='bx bxs-dashboard bx-md' title="Electric Meter Dashboard"
                    style="margin-top: 5px;"></a>
            </li>
            <li
                style="align-content:center;margin-top: 0.5rem;margin-bottom: 0.5rem;text-align: center;text-decoration: none; --selectionColor: #FFE493; --selectionColorBG: #FFE49383; ">
                <a href="{% url 'thermalComfort'%}" style="margin-top: 5px;" class='bx bxs-thermometer bx-md'
                    title="Thermal Comfort"></a>
            </li>
            <li style="align-content:center;margin-top: 0.5rem;margin-bottom: 0.5rem;text-align: center;text-decoration: none; --selectionColor: #D2EB99; --selectionColorBG: #D2EB9983; "
                title="Carpark">
                <a href="{% url 'carPark' %}" style="margin-top: 5px;" class='bx bxs-car-garage bx-md'></a>
            </li>
            <li style="align-content:center;margin-top: 0.5rem;margin-bottom: 0.5rem;text-align: center;text-decoration: none; --selectionColor: #7EB6E0; --selectionColorBG: #7EB6E083; "
                title="EV Charging">
                <a href="{% url 'evCharging' %}" style="margin-top: 5px;" class='bx bxs-ev-station bx-md'></a>
            </li>
            <li class="active"
                style="align-content:center;margin-top: 0.5rem;margin-bottom: 0.5rem;text-align: center;text-decoration: none; --selectionColor: #D7FEFF; --selectionColorBG: #D7FEFF83; "
                title="Weather Station">
                <a href="{% url 'weather' %}" style="margin-top: 5px;" class='bx bx-cloud-snow bx-md'></a>
            </li>
            <li style="align-content:center;margin-top: 0.5rem;margin-bottom: 0.5rem;text-align: center;text-decoration: none; --selectionColor: #3C91E6; --selectionColorBG: #3C91E683; "
                title="EOTF">
                <a href="{% url 'eotf' %}" style="margin-top: 5px;" class='bx bx-notepad bx-md'></a>
            </li>

            <li style="align-content:center;margin-top: 0.5rem;margin-bottom: 0.5rem;text-align: center;text-decoration: none; --selectionColor: #b2585e; --selectionColorBG: #b2585e83; "
                title="Traffic">
                <a href="{% url 'traffic' %}" style="margin-top: 5px;" class='bx bxs-traffic-barrier bx-md'></a>
            </li>
            <li style="align-content:center;margin-top: 0.5rem;margin-bottom: 0.5rem;text-align: center;text-decoration: none; --selectionColor: #e6913c; --selectionColorBG: #e6913c83; "
                title="IBMS">
                <a href="https://obsi.sydney/Apps/IBMS/rtsystem.json?key=5227" target="_blank" style="margin-top: 5px;"
                    class='bx bx-line-chart bx-md'></a>
            </li>
            <li style="align-content:center;margin-top: 0.5rem;margin-bottom: 0.5rem;text-align: center;text-decoration: none; --selectionColor: #3ce691; --selectionColorBG: #3ce69183; "
                title="Card Holders">
                <a href="https://obsi.sydney/Apps/AccessCard/cardholders" target="_blank" style="margin-top: 5px;"
                    class='bx bx-id-card bx-md'></a>
            </li>
            <li style="align-content:center;margin-top: 0.5rem;margin-bottom: 0.5rem;text-align: center;text-decoration: none; --selectionColor: #e63c91; --selectionColorBG: #e63c9183; "
                title="Reports">
                <a href="https://obsi.sydney/Apps/CrystalReportsConnector/dashboard" target="_blank"
                    style="margin-top: 5px;" class='bx bx-bar-chart-alt-2 bx-md'></a>
            </li>
        </ul>
    </section>
    <!-- SIDEBAR -->


    <!-- CONTENT -->
    <section id="content" style="background-color: white;">
        <!-- NAVBAR -->

        <!-- NAVBAR -->

        <!-- MAIN -->
        <main id="mainBG" style="background-color: #E3D91F;">
            <div class="container justify-content-center max" style="max-width:90vw">
                <div class="row">
                    <div class="row g-3">
                        <div class="col-6 pb-3">
                            <p class="fs-2 fw-bold mb-0" style="color: #3B3462;">
                                Electric Meter Tree
                            </p>
                        </div>
                        <div class="col-5 btn-group d-sm-flex justify-content-end">

                            <div class="col-1"><i class='bx bx-chevrons-right bx-fade-right bx-flip-vertical bx-md'></i>
                            </div>
                            <div class="col-2">
                                <p class="fs-5 text-center fw-bold" id="CatText">All</p>
                            </div>
                            <div class="col-2 pl-4 ml-4"><i
                                    class='bx bx-chevrons-left bx-fade-left bx-flip-vertical bx-md'></i></div>
                            <div class="col-2">
                                <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false" id="catagoryButton">
                                    Category
                                </button>
                                <div class="dropdown-menu dropdown-menu-right">
                                    {% for i in allCat %}
                                    <button class="dropdown-item" type="button" value="{{ i }}"
                                    onclick="chnageMeterCat(this.value)">{{i}}</button>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="col-2">
                                <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false" id="levelButton">
                                    Levels
                                </button>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <button class="dropdown-item" type="button" value="low"
                                        onclick="chnageMeterLvl(this.value)">Low Rise</button>
                                    <button class="dropdown-item" type="button" value="mid"
                                        onclick="chnageMeterLvl(this.value)">Mid Rise</button>
                                    <button class="dropdown-item" type="button" value="high"
                                        onclick="chnageMeterLvl(this.value)">High Rise</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row overflow-auto border p-1"
                        style="height: 86vh; min-width:80vw; border-radius:1rem; background-color:rgb(255, 255, 255);"
                        id="meterTreeContainer">
                        <div class="col-11" id="meterTree" style="border-radius: 1rem;"></div>
                    </div>
                </div>
            </div>

        </main>

        <!-- MAIN -->
    </section>
    <!-- CONTENT -->



    <script>
        document.getElementById("mainBG").style.backgroundColor = '#E3D91F';

        function chnageMeterCat(cat) {
            document.getElementById("CatText").innerText = cat
            cat_meters_r = []
            for (let i = 0; i < cat_wise_record[cat][0].length; i++) {
                cat_meters_r.push({
                    id: cat_wise_record[cat][0][i][1].toLowerCase().replaceAll("-", ""),
                    x: cat_wise_record[cat][0][i][1],
                    parent: cat_wise_record[cat][0][i][0].toLowerCase().replaceAll("-", ""),
                    attributes: { description: cat_wise_record[cat][0][i][2] }
                });
            }
            for (let i = 0; i < cat_wise_record[cat][1].length; i++) {
                cat_meters_r.push({
                    id: cat_wise_record[cat][1][i][0].toLowerCase().replaceAll("-", ""),
                    x: cat_wise_record[cat][1][i][0],
                    attributes: { description: cat_wise_record[cat][1][i][1] }
                });
            }
            var chart = JSC.chart('meterTree', {
                debug: true,
                type: 'organizational right',
                defaultTooltip_enabled: false,
    
                /* These options will apply to all annotations including point nodes. */
                defaultAnnotation: {
                    padding: [5, 10],
                    margin: 10
                },
                box: {
                    radius: 16,
                    fill: "#ffffff",
                    padding: 16
                },
    
                defaultSeries: {
                    color: normalFill,
                    /* Point selection is disabled because it is managed manually with point click events. */
                    pointSelection: false
                },
                defaultPoint: {
                    focusGlow: false,
                    connectorLine: {
                        color: '#000000',
                        radius: [10, 30],
                        caps: { end: { type: "arrow", size: 6 } },
                        width: 1.5,
                    },
                    label: {
                        text:
                            '%name<br><span style="color:#9E9E9E">%description</span>',
                        style_color: 'black'
                    },
                    outline: { color: '#000000', width: 1 },
                    annotation: { syncHeight_with: 'all', syncWidth_with: 'all' },
    
                    states: {
                        credits: { enabled: false },
                        mute: {
                            opacity: 0.8,
                            outline: {
                                color: mutedHighlightColor,
                                opacity: 0.9,
                                width: 3
                            },
                            color: mutedFill
                        },
                        select: {
                            enabled: true,
                            outline: {
                                color: highlightColor,
                                width: 3
                            },
                            color: selectedFill
                        },
                        hover: {
                            outline: {
                                color: mutedHighlightColor,
                                width: 3
                            },
                            color: mutedFill
                        }
                    },
                    events: {
                        click: pointClick,
                        mouseOver: pointMouseOver,
                        mouseOut: pointMouseOut,
                    }
                },
                series: [{ points: cat_meters_r }]
            }); 
        }
        function chnageMeterLvl(cat) {
            document.getElementById("CatText").innerText = cat.toUpperCase() + " Rise";
            if (cat == "low") {
                var chart = JSC.chart('meterTree', {
                    debug: true,
                    type: 'organizational right',
                    defaultTooltip_enabled: false,
        
                    /* These options will apply to all annotations including point nodes. */
                    defaultAnnotation: {
                        padding: [5, 10],
                        margin: 10
                    },
                    box: {
                        radius: 16,
                        fill: "#ffffff",
                        padding: 16
                    },
        
                    defaultSeries: {
                        color: normalFill,
                        /* Point selection is disabled because it is managed manually with point click events. */
                        pointSelection: false
                    },
                    defaultPoint: {
                        focusGlow: false,
                        connectorLine: {
                            color: '#000000',
                            radius: [10, 30],
                            caps: { end: { type: "arrow", size: 6 } },
                            width: 1.5,
                        },
                        label: {
                            text:
                                '%name<br><span style="color:#9E9E9E">%description</span>',
                            style_color: 'black'
                        },
                        outline: { color: '#000000', width: 1 },
                        annotation: { syncHeight_with: 'all', syncWidth_with: 'all' },
        
                        states: {
                            credits: { enabled: false },
                            mute: {
                                opacity: 0.8,
                                outline: {
                                    color: mutedHighlightColor,
                                    opacity: 0.9,
                                    width: 3
                                },
                                color: mutedFill
                            },
                            select: {
                                enabled: true,
                                outline: {
                                    color: highlightColor,
                                    width: 3
                                },
                                color: selectedFill
                            },
                            hover: {
                                outline: {
                                    color: mutedHighlightColor,
                                    width: 3
                                },
                                color: mutedFill
                            }
                        },
                        events: {
                            click: pointClick,
                            mouseOver: pointMouseOver,
                            mouseOut: pointMouseOut,
                        }
                    },
                    series: [{ points: meters_r_low }]
                }); 
            }
            else if (cat == "mid") {
                var chart = JSC.chart('meterTree', {
                    debug: true,
                    type: 'organizational right',
                    defaultTooltip_enabled: false,
        
                    /* These options will apply to all annotations including point nodes. */
                    defaultAnnotation: {
                        padding: [5, 10],
                        margin: 10
                    },
                    box: {
                        radius: 16,
                        fill: "#ffffff",
                        padding: 16
                    },
        
                    defaultSeries: {
                        color: normalFill,
                        /* Point selection is disabled because it is managed manually with point click events. */
                        pointSelection: false
                    },
                    defaultPoint: {
                        focusGlow: false,
                        connectorLine: {
                            color: '#000000',
                            radius: [10, 30],
                            caps: { end: { type: "arrow", size: 6 } },
                            width: 1.5,
                        },
                        label: {
                            text:
                                '%name<br><span style="color:#9E9E9E">%description</span>',
                            style_color: 'black'
                        },
                        outline: { color: '#000000', width: 1 },
                        annotation: { syncHeight_with: 'all', syncWidth_with: 'all' },
        
                        states: {
                            credits: { enabled: false },
                            mute: {
                                opacity: 0.8,
                                outline: {
                                    color: mutedHighlightColor,
                                    opacity: 0.9,
                                    width: 3
                                },
                                color: mutedFill
                            },
                            select: {
                                enabled: true,
                                outline: {
                                    color: highlightColor,
                                    width: 3
                                },
                                color: selectedFill
                            },
                            hover: {
                                outline: {
                                    color: mutedHighlightColor,
                                    width: 3
                                },
                                color: mutedFill
                            }
                        },
                        events: {
                            click: pointClick,
                            mouseOver: pointMouseOver,
                            mouseOut: pointMouseOut,
                        }
                    },
                    series: [{ points: meters_r_mid }]
                }); 
            }
            else if (cat == "high") {
                var chart = JSC.chart('meterTree', {
                    debug: true,
                    type: 'organizational right',
                    defaultTooltip_enabled: false,
        
                    /* These options will apply to all annotations including point nodes. */
                    defaultAnnotation: {
                        padding: [5, 10],
                        margin: 10
                    },
                    box: {
                        radius: 16,
                        fill: "#ffffff",
                        padding: 16
                    },
        
                    defaultSeries: {
                        color: normalFill,
                        /* Point selection is disabled because it is managed manually with point click events. */
                        pointSelection: false
                    },
                    defaultPoint: {
                        focusGlow: false,
                        connectorLine: {
                            color: '#000000',
                            radius: [10, 30],
                            caps: { end: { type: "arrow", size: 6 } },
                            width: 1.5,
                        },
                        label: {
                            text:
                                '%name<br><span style="color:#9E9E9E">%description</span>',
                            style_color: 'black'
                        },
                        outline: { color: '#000000', width: 1 },
                        annotation: { syncHeight_with: 'all', syncWidth_with: 'all' },
        
                        states: {
                            credits: { enabled: false },
                            mute: {
                                opacity: 0.8,
                                outline: {
                                    color: mutedHighlightColor,
                                    opacity: 0.9,
                                    width: 3
                                },
                                color: mutedFill
                            },
                            select: {
                                enabled: true,
                                outline: {
                                    color: highlightColor,
                                    width: 3
                                },
                                color: selectedFill
                            },
                            hover: {
                                outline: {
                                    color: mutedHighlightColor,
                                    width: 3
                                },
                                color: mutedFill
                            }
                        },
                        events: {
                            click: pointClick,
                            mouseOver: pointMouseOver,
                            mouseOut: pointMouseOut,
                        }
                    },
                    series: [{ points: meters_r_high }]
                }); 
            }
        }

        meter_relations = {{ meter_relations | safe }};
        parents = {{ parents | safe }};
        lowRise_meter_relations = {{ lowRise_meter_relations | safe }};
        lowRise_parents = {{ lowRise_parents | safe }};
        midRise_meter_relations = {{ midRise_meter_relations | safe }};
        midRise_parents = {{ midRise_parents | safe }};
        highRise_meter_relations = {{ highRise_meter_relations | safe }};
        highRise_parents = {{ highRise_parents | safe }};
        cat_wise_record = {{ cat_wise_record | safe }};

        meters_r = [];
        for (let i = 0; i < meter_relations.length; i++) {
            meters_r.push({
                id: meter_relations[i][1].toLowerCase().replaceAll("-", ""),
                x: meter_relations[i][1],
                parent: meter_relations[i][0].toLowerCase().replaceAll("-", ""),
                attributes: { description: meter_relations[i][2] }
            });
        }
        for (let i = 0; i < parents.length; i++) {
            meters_r.push({
                id: parents[i][0].toLowerCase().replaceAll("-", ""),
                x: parents[i][0],
                attributes: { description: parents[i][1] }
            });
        }
        meters_r_low = [];
        for (let i = 0; i < lowRise_meter_relations.length; i++) {
            meters_r_low.push({
                id: lowRise_meter_relations[i][1].toLowerCase().replaceAll("-", ""),
                x: lowRise_meter_relations[i][1],
                parent: lowRise_meter_relations[i][0].toLowerCase().replaceAll("-", ""),
                attributes: { description: lowRise_meter_relations[i][2] }
            });
        }
        for (let i = 0; i < lowRise_parents.length; i++) {
            meters_r_low.push({
                id: lowRise_parents[i][0].toLowerCase().replaceAll("-", ""),
                x: lowRise_parents[i][0],
                attributes: { description: lowRise_parents[i][1] }
            });
        }

        meters_r_mid = [];
        for (let i = 0; i < midRise_meter_relations.length; i++) {
            meters_r_mid.push({
                id: midRise_meter_relations[i][1].toLowerCase().replaceAll("-", ""),
                x: midRise_meter_relations[i][1],
                parent: midRise_meter_relations[i][0].toLowerCase().replaceAll("-", ""),
                attributes: { description: midRise_meter_relations[i][2] }
            });
        }
        for (let i = 0; i < midRise_parents.length; i++) {
            meters_r_mid.push({
                id: midRise_parents[i][0].toLowerCase().replaceAll("-", ""),
                x: midRise_parents[i][0],
                attributes: { description: midRise_parents[i][1] }
            });
        }

        meters_r_high = [];
        for (let i = 0; i < highRise_meter_relations.length; i++) {
            meters_r_high.push({
                id: highRise_meter_relations[i][1].toLowerCase().replaceAll("-", ""),
                x: highRise_meter_relations[i][1],
                parent: highRise_meter_relations[i][0].toLowerCase().replaceAll("-", ""),
                attributes: { description: highRise_meter_relations[i][2] }
            });
        }
        for (let i = 0; i < highRise_parents.length; i++) {
            meters_r_high.push({
                id: highRise_parents[i][0].toLowerCase().replaceAll("-", ""),
                x: highRise_parents[i][0],
                attributes: { description: highRise_parents[i][1] }
            });
        }

        // JS 
        var selectedPoint;
        var highlightDirection = 'Both',
            highlightUpColor = '#1aa8ff',
            highlightDownColor = '#006e98';
        var highlightColor = '#5C6BC0',
            mutedHighlightColor = '#9FA8DA',
            mutedFill = '#f3f4fa',
            selectedFill = '#E8EAF6',
            normalFill = '#e4fef1';

        var points = meters_r;

        var chart = JSC.chart('meterTree', {
            debug: true,
            type: 'organizational right',
            defaultTooltip_enabled: false,

            /* These options will apply to all annotations including point nodes. */
            defaultAnnotation: {
                padding: [5, 10],
                margin: 10
            },
            box: {
                radius: 16,
                fill: "#ffffff",
                padding: 16
            },

            defaultSeries: {
                color: normalFill,
                /* Point selection is disabled because it is managed manually with point click events. */
                pointSelection: false
            },
            defaultPoint: {
                focusGlow: false,
                connectorLine: {
                    color: '#000000',
                    radius: [10, 30],
                    caps: { end: { type: "arrow", size: 6 } },
                    width: 1.5,
                },
                label: {
                    text:
                        '%name<br><span style="color:#9E9E9E">%description</span>',
                    style_color: 'black'
                },
                outline: { color: '#000000', width: 1 },
                annotation: { syncHeight_with: 'all', syncWidth_with: 'all' },

                states: {
                    credits: { enabled: false },
                    mute: {
                        opacity: 0.8,
                        outline: {
                            color: mutedHighlightColor,
                            opacity: 0.9,
                            width: 3
                        },
                        color: mutedFill
                    },
                    select: {
                        enabled: true,
                        outline: {
                            color: highlightColor,
                            width: 3
                        },
                        color: selectedFill
                    },
                    hover: {
                        outline: {
                            color: mutedHighlightColor,
                            width: 3
                        },
                        color: mutedFill
                    }
                },
                events: {
                    click: pointClick,
                    mouseOver: pointMouseOver,
                    mouseOut: pointMouseOut,
                }
            },
            series: [{ points: points }]
        });
        
        /** 
         * Event Handlers 
         */
        function reDirectLink() {
            window.location.href = "{% url 'meterPage' %}";
        };
        function pointClick() {
            var point = this,
                chart = point.chart;
            resetStyles(chart);
            if (point.id === selectedPoint) {
                reDirectLink();
            }
            selectedPoint = point.id;
            styleSelectedPoint(chart);
        }

        function pointMouseOver() {
            var point = this,
                chart = point.chart;
            highlightUp(point.id);
            highlightDown(point.id);

            chart
                .series()
                .points(point.id)
                .options({ selected: true, muted: false });

            updateInfo(point);

            // Use the selected state to highlight up the tree. 
            function highlightUp(id) {
                chart.connectors([id, 'up'], {
                    color: highlightUpColor,
                    width: 3
                });
                chart
                    .series()
                    .points([id, 'up'])
                    .options({ selected: true, muted: false });
            }

            // Use the muted state to highlight points down the tree. 
            function highlightDown(id) {
                chart.connectors([id, 'down'], {
                    color: highlightDownColor,
                    width: 3
                });
                chart
                    .series()
                    .points([id, 'down'])
                    .options({ selected: false, muted: true });
            }
        }

        function pointMouseOut() {
            var point = this,
                chart = point.chart;
            // Reset point and line styling. 
            resetStyles(chart);
            // Style clicked points 
            styleSelectedPoint(chart);
            return false;
        }

        /** 
         * Styling helper functions 
         */

        function styleSelectedPoint(chart) {
            if (selectedPoint) {
                chart.connectors([selectedPoint, 'up'], {
                    color: highlightUpColor,
                    width: 3
                });
                chart
                    .series()
                    .points([selectedPoint, 'up'])
                    .options({ selected: true, muted: false });

                chart.connectors([selectedPoint, 'down'], {
                    color: highlightDownColor,
                    width: 3
                });
                chart
                    .series()
                    .points([selectedPoint, 'down'])
                    .options({ selected: false, muted: true });
            }
        }

        /** 
         * Clears connectors and point states. 
         * @param chart Chart object 
         */
        function resetStyles(chart) {
            chart.connectors();
            chart
                .series()
                .points()
                .options({ selected: false, muted: false });
        }
    </script>

</body>

</html>